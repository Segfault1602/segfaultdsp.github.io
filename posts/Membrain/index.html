<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alexandre St-Onge">
<meta name="dcterms.date" content="2025-01-09">
<meta name="keywords" content="Digital Musical Instruments, drumhead, sensors, capacitive touch, piezo, time of flight, linear Hall-effect">

<title>Membrain: Extending the drumhead – SegfaultDSP</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6d5f49080fd7a04518cb6db3008564bf.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-210NT6BWYX"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
 
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied'
  });
gtag('config', 'G-210NT6BWYX', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">SegfaultDSP</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/segfault1602"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../posts/Membrain/index.html">Posts</a></li><li class="breadcrumb-item"><a href="../../posts/Membrain/index.html">Membrain: Extending the drumhead</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../posts/Membrain/index.html">Posts</a></li><li class="breadcrumb-item"><a href="../../posts/Membrain/index.html">Membrain: Extending the drumhead</a></li></ol></nav>
      <h1 class="title">Membrain: Extending the drumhead</h1>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://segfaultdsp.com">Alexandre St-Onge</a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://www.mcgill.ca/">
              McGill University
              </a>
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 9, 2025</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">January 9, 2025</p>
      </div>
    </div>
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Abstract</div>
      <p>This paper introduces the Membrain, a prototyping platform allowing the exploration of various sensors in the context of a drumhead or flexible membrane. Most digital musical instruments (DMI) that are created at IDMIL make use of isometric sensors like FSRs, or piezoelectric sensors on hard surfaces. The Membrain aims to provide a platform for instrument designers in the lab to explore the use of flexible membranes and how they can be incorporated into future DMIs. The paper will present the design of the prototype, the sensors used, the user interface, and the mappings used to test the prototype.</p>
    </div>
  </div>

  <div>
    <div class="keywords">
      <div class="block-title">Keywords</div>
      <p>Digital Musical Instruments, drumhead, sensors, capacitive touch, piezo, time of flight, linear Hall-effect</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Posts</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/Membrain/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Membrain: Extending the drumhead</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/2d_mesh_sandbox/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2D Mesh Sandbox</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Bowed String</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/bowed_string/waveguide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BowedString Part 1: Digital Waveguide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/bowed_string/bow_table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BowedString Part 2: Bow Table</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/bowed_string/bowed_string_example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">BowedString Part 3: BowedString audio example</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Automatic Optimization of Feedback Delay Networks</span></span>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Phaseshaper</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/phaseshaper/phaseshaper.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Phaseshaping Oscillator</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Windowed Sinc</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../posts/windowed_sinc/windowed_sinc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Windowed sinc resampling</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<section id="membrain-extending-the-drumhead" class="level1 page-columns page-full">
<h1>Membrain: Extending the drumhead</h1>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>Despite their popularity and the number of different offerings on the market, percussive digital devices often relies on the same sensors and technologies<span class="citation" data-cites="tindale_comparison_2005"><a href="#ref-tindale_comparison_2005" role="doc-biblioref">[1]</a></span>. Tindale et al.&nbsp;presented a comparison of different sensors used in digital percussion instruments and found that most of them rely mostly on sensors that only measure velocity at the moment of impact. While the paper presents a good overview of the different sensors available, it mostly focuses on sensors that can provide information on the strike itself, ex.: velocity, position, angle of incidence, etc. I am interested in exploring sensors that can provide information on the state of the drumhead itself. For example, the jazz drummer <a href="https://www.youtube.com/watch?v=WfwlW_a99Jw">Ari Hoenig</a> often plays melodies on his drums by using his elbow or hand to press on the drumhead in order to change the pitch of the drum.</p>
<p>The tabla is another example of a percussion instrument where interaction with the drumhead is important. By pressing on the drumhead, the player can change the pitch of the drum. Pardue et al.&nbsp;presented a paper on the design of a digital tabla<span class="citation" data-cites="pardue_demystifying_2020"><a href="#ref-pardue_demystifying_2020" role="doc-biblioref">[2]</a></span>. Their design is based on optical reflectance sensors placed underneath the membrane allowing them to detect and localize strikes as well as damping<span class="citation" data-cites="pardue_demystifying_2020"><a href="#ref-pardue_demystifying_2020" role="doc-biblioref">[2]</a></span>.</p>
<p>The optical reflectance sensors used in the digital tabla were based on previous work by Sokolovskis and McPherson<span class="citation" data-cites="sokolovskis_optical_2014"><a href="#ref-sokolovskis_optical_2014" role="doc-biblioref">[3]</a></span>. In their design, six QRE1113 sensors were placed underneath a drumhead, providing a noninvasive way to detect strikes and other interactions with the drumhead.</p>
</section>
<section id="design" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="design">Design</h2>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../assets/membrain/membrain.jpeg" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="The Membrain prototype."><img src="../assets/membrain/membrain.jpeg" class="img-fluid figure-img" alt="The Membrain prototype."></a></p>
<figcaption>The Membrain prototype.</figcaption>
</figure>
</div>
</div></div><p>The Membrain prototype was built using a <a href="https://sabian.com/product/qt-sd14cl-14-quiet-tone-snare-drum-practice-pad-classic-version/">Sabian Quiet Tone practice pad</a> as the base. The practice pad was chosen due to its size and the fact that it allows the use of a real drumhead. The drumhead chosen was a mesh drumhead, which on top of being silent, allowed me to easily sow conductive thread through it to use as capacitive sensors. Furthermore, the frame of the practice pad allowed me to attach various sensors underneath the drumhead easily.</p>
<section id="sensors" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sensors">Sensors</h3>
<p>Several sensors were used in the prototype:</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../assets/membrain/piezo.jpeg" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="A piezoelectric sensor attached to the drumhead."><img src="../assets/membrain/piezo.jpeg" class="img-fluid figure-img" alt="A piezoelectric sensor attached to the drumhead."></a></p>
<figcaption>A piezoelectric sensor attached to the drumhead.</figcaption>
</figure>
</div>
</div></div><section id="piezo" class="level4">
<h4 class="anchored" data-anchor-id="piezo">Piezo</h4>
<p>A simple piezoelectric sensor was attached to the top of the drumhead to detect impact on the drumhead. A piece of double-sided foam tape was used to fix the piezo to the drumhead as well as to provide a small amount of physical low-pass filtering to the signal going to the piezo.</p>
</section>
<section id="capacitive-sensors" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="capacitive-sensors">Capacitive sensors</h4>
<p>Capacitive touch sensors were used as buttons to trigger various events. The capacitive sensors were made of <a href="https://www.adafruit.com/product/603">conductive thread</a> sown through the drumhead and connected directly to a general-purpose input/ouput (GPIO) pin on the microcontroller. Four such sensors were used in the prototype. Three of them were placed in a line near the rim of the drumhead in such a way as to allow easy finger drumming using the index, middle, and ring fingers of my right hand. The fourth sensor was placed on the opposite side of the drumhead and was meant to be used as a modifier key for the system.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../assets/membrain/capacitive.jpeg" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Capacitive sensor made of conductive thread."><img src="../assets/membrain/capacitive.jpeg" class="img-fluid figure-img" alt="Capacitive sensor made of conductive thread."></a></p>
<figcaption>Capacitive sensor made of conductive thread.</figcaption>
</figure>
</div>
</div></div></section>
<section id="infrared-time-of-flight-sensor" class="level4">
<h4 class="anchored" data-anchor-id="infrared-time-of-flight-sensor">Infrared Time of Flight sensor</h4>
<p>A time of flight sensor from ST Microelectronics and <a href="https://www.adafruit.com/product/3316">Adafruit</a> was used as a way to detect the flexion of the drumhead. The sensor was placed underneath the drumhead on one of the transversal bars of the practice pad frame. A piece of black tape was placed on the drumhead above the sensor to as the translucent nature of the mesh drumhead made it difficult to get a <span style="border-radius: 0.2rem; padding: 0 0.2rem 0 0.2rem;background-color: #ffe433;">good reading</span> from the sensor. The sensor was connected to the microcontroller using the I2C protocol.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Define ‘good reading’</li>
</ul>
</div>
</div>
</section>
<section id="linear-hall-effect-sensor" class="level4">
<h4 class="anchored" data-anchor-id="linear-hall-effect-sensor">Linear Hall-effect sensor</h4>
<p>Three <a href="https://www.allegromicro.com/-/media/files/datasheets/als31001-datasheet.pdf">linear Hall-effect sensors</a> were also used as a way to detect the flexion of the drumhead. The sensors were placed underneath the drumhead using custom 3D-printed mounts. Several configurations were tested, but the most successful one was to place the sensors side by side with roughly 15mm separating each sensor. Each sensor had a small magnet attached to the drumhead directly above. The sensors were connected to the microcontroller built-in ADC.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Add specs for ADC</li>
</ul>
</div>
</div>
</section>
<section id="user-interface" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="user-interface">User Interface</h4>
<p>An <a href="https://www.adafruit.com/product/1426">LED stick</a> of eigth WS2812B LEDs was used as a visual feedback for the system. The device shows up as a MIDI device when connected to a computer through USB.</p>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../assets/membrain/ledstick.jpeg" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Raspberry Pi Pico 2 and LED stick."><img src="../assets/membrain/ledstick.jpeg" class="img-fluid figure-img" alt="Raspberry Pi Pico 2 and LED stick."></a></p>
<figcaption>Raspberry Pi Pico 2 and LED stick.</figcaption>
</figure>
</div>
</div></div></section>
</section>
</section>
<section id="implementation" class="level2">
<h2 class="anchored" data-anchor-id="implementation">Implementation</h2>
<p>A <a href="https://www.raspberrypi.com/products/raspberry-pi-pico-2/">Raspberry Pi Pico 2</a> was used as the microcontroller for the prototype. The Pico 2 was chosen due to its small size, low cost, and number of GPIO pins available. The firmware was written in C++ and used <a href="https://www.freertos.org/">FreeRTOS</a> and <a href="https://docs.tinyusb.org/en/latest/">TinyUSB</a> as the RTOS and USB stack respectively. The source code for the firmware is available on <a href="https://github.com/Segfault1602/Membrain">GitHub</a>.</p>
</section>
<section id="mappings" class="level2">
<h2 class="anchored" data-anchor-id="mappings">Mappings</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../assets/membrain/vcv_rack.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="The VCV Rack software."><img src="../assets/membrain/vcv_rack.png" class="img-fluid figure-img" style="float:right; width: 50%;" alt="The VCV Rack software."></a></p>
<figcaption>The VCV Rack software.</figcaption>
</figure>
</div>
<p>To test the sensors with various mapping strategies, the software VCV Rack was used. Initially, Ableton Live was used, but I found it difficult to quickly test various mappings as it does not easily allow arbitrary MIDI mappings. In VCV Rack, every MIDI message is translated to a control voltage signal which can be easily routed and manipulated. Since the software is also performance-oriented, it was easy to test various mappings in real time while also being able to create compelling sounds.</p>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p><a href="../assets/membrain/membrain2.jpeg" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="The Membrain prototype."><img src="../assets/membrain/membrain2.jpeg" class="img-fluid" style="float:right; width: 50%;" alt="The Membrain prototype."></a> <!-- \begin{figure}
  \centering
  \includegraphics[angle=-90, width=1\columnwidth]{membrain2.jpeg}
  \caption{The Membrain prototype.}\label{fig:membrain_side}
\end{figure} --></p>
<p>The first sensor to be tested was the capacitive touch sensor. I had my doubts at first due to the apparent simplicity of the sensors, but they turned out to be surprisingly responsive. A common problem I encounter with FSRs is that it can be difficult to play fast notes as their software <span style="border-radius: 0.2rem; padding: 0 0.2rem 0 0.2rem;background-color: #ffe433;">implementation</span> often requires that your finger be completely off the sensor before it can be triggered again, which can be difficult to achieve doing rapid strokes with your hands or fingers.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Whose implementation?</li>
</ul>
</div>
</div>
<p>In theory, the capacitive sensors will suffer from the same problem, but since they are so cheap and easy to implement, it becomes trivial to add more sensors such that each finger can have its own touchpad. By using conductive thread, it is also possible to create sensors of arbitrary shapes and sizes and, with the mesh drumhead, could be placed anywhere on the drumhead. As long as care is taken to avoid short circuits, there is no cross-talk between the sensors.</p>
<p>The biggest downside of the capacitive sensors is that they act strictly as an on/off switch. Even with other modulation sources, the lack of velocity information can make the instrument feel less expressive.</p>
<p>The piezo sensor was also surprisingly easy to integrate. From experience with commercial drum triggers which also use piezo sensors, I was expecting it would require quite a bit of work to get a good response from the sensor. Commercial drum triggers are usually attached to the rim of the drum and use a layer of foam between the drumhead and the sensor. Sensitivity and debouncing parameters often need to be adjusted in order to get a good response from the trigger. Simply using a piece of double-sided foam tape was enough for me to get an <span style="border-radius: 0.2rem; padding: 0 0.2rem 0 0.2rem;background-color: #ffe433;">acceptable response</span> from the sensor. The piezo I chose also came with a simple trigger detection circuit which made it easy to connect to the microcontroller.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Define ‘acceptable response’</li>
</ul>
</div>
</div>
<p>The time of flight sensor was the most difficult to integrate, mostly due to the fact that the module would often fail initialization or would sometime get stuck in a state where it would always return the same value. The resolution of 1mm was also not enough to detect small flexions of the drumhead which limited the amount of parameters it could be mapped to. For example, trying to control the pitch of an oscillator with the sensor was not very satisfying as the pitch sounded very quantized. This was also due to the fact that the membrane would only be flexed over a distance of approximately 1cm, which meant that the sensor would only be able to detect 10 different states. A big advantage of this type of sensor is that it is non-invasive and does not need to be placed close to the drumhead to work. This can be useful in a context where space close to the drumhead is limited.</p>
<p>The linear Hall-effect sensors were the most successful in the prototype. The sensors were surprisingly easy to integrate and provided a <span style="border-radius: 0.2rem; padding: 0 0.2rem 0 0.2rem;background-color: #ffe433;">decent resolution</span> that made them useful for controlling continuous parameters. I was able to use 3 sensors placed side by side to detect the flexion of the drumhead in a way that felt very natural. It is important to understand that the tension of the drumhead is not uniform, for example, it is much harder to flex the drumhead near the rim than near the center. This can be an important piece of tactile feedback when interacting with the drumhead. I was able to place the sensors in such a way that sliding my hand from the center to the rim would raise the pitch of the sound.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Define ‘decent resolution’</li>
</ul>
</div>
</div>
<p>The obvious downside of the linear Hall-effect sensors is that they are invasive as they require some kind of magnetic material to be attached to the drumhead. This can be a problem if keeping the natural sound of the membrane is important. The type of magnet used is also important, as the strength of the magnetic field will dictate how far the sensor can be placed from the magnet. In my case, I found that I needed to place the magnet very close to the sensor (approximately 1cm) to get a good reading.</p>
</section>
<section id="future-work" class="level2">
<h2 class="anchored" data-anchor-id="future-work">Future Work</h2>
<p>Given that one of the goals of this project is to provide a prototyping platform for other IDMIL members, the next step would be to add OSC support to the firmware. This would allow the Membrain to take advantage of <a href="https://libmapper.github.io/">libMapper</a> which is a powerful tool for building flexible mapping.</p>
<p>Another interesting avenue of exploration would be to use more than one piezo sensor. Paradiso et al.&nbsp;were able to detect the location and type of impact on a surface using 4 piezo sensors located at the corners of a surface<span class="citation" data-cites="paradiso_passive_2002"><a href="#ref-paradiso_passive_2002" role="doc-biblioref">[4]</a></span>. A smaller piezo sensor could also be placed directly on the rim of the drumhead to detect rim shots. Finally, finding a way to include velocity information in the capacitive sensors would be a big improvement. One possible way to achieve this could be to use a piezo sensor directly underneath the capacitive sensor and use the fusion of the two signals to determine the velocity and location of the strike. Embedding a layer of velostat material into the drumhead could also be an interesting thing to try.</p>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>In this paper, I presented the Membrain, a prototyping platform for exploring the use of flexible membranes in digital musical instruments. Built on top of a practice pad, the Membrain allows the exploration of various sensors such as piezo, capacitive touch, time of flight, and linear Hall-effect sensors. The form factor of the device makes it easy to add sensors or simply change their placement on the membrane. The prototype was tested with various mappings in VCV Rack and showed promising results.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-tindale_comparison_2005" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">A. R. Tindale, A. Kapur, G. Tzanetakis, P. Driessen, and A. Schloss, <span>“A comparison of sensor strategies for capturing percussive gestures,”</span> in <em>Proceedings of the international conference on new interfaces for musical expression</em>, Vancouver, <span>BC</span>, Canada, 2005, pp. 200–203. doi: <a href="https://doi.org/10.5281/zenodo.1176828">10.5281/zenodo.1176828</a>.</div>
</div>
<div id="ref-pardue_demystifying_2020" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">L. S. Pardue, K. Bhamra, G. England, P. Eddershaw, and D. Menzies, <span>“Demystifying tabla through the development of an electronic drum,”</span> Jun. 2020, doi: <a href="https://doi.org/10.5281/ZENODO.4813212">10.5281/ZENODO.4813212</a>.</div>
</div>
<div id="ref-sokolovskis_optical_2014" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">J. Sokolovskis and A. McPherson, <span>“Optical measurement of acoustic drum strike locations,”</span> in <em>Proceedings of the international conference on new interfaces for musical expression</em>, London, United Kingdom: Goldsmiths, University of London, Jun. 2014, pp. 70–73. doi: <a href="https://doi.org/10.5281/zenodo.1178943">10.5281/zenodo.1178943</a>.</div>
</div>
<div id="ref-paradiso_passive_2002" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">J. A. Paradiso, C. K. Leo, N. Checka, and K. Hsiao, <span>“Passive acoustic sensing for tracking knocks atop large interactive displays,”</span> in <em>2002 <span>IEEE</span> <span>SENSORS</span></em>, Jun. 2002, pp. 521–527 vol.1. doi: <a href="https://doi.org/10.1109/ICSENS.2002.1037150">10.1109/ICSENS.2002.1037150</a>.</div>
</div>
</div>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{st-onge2025,
  author = {St-Onge, Alexandre},
  title = {Membrain: {Extending} the Drumhead},
  date = {2025-01-09},
  url = {https://segfaultdsp.com/posts/Membrain/},
  langid = {en},
  abstract = {This paper introduces the Membrain, a prototyping platform
    allowing the exploration of various sensors in the context of a
    drumhead or flexible membrane. Most digital musical instruments
    (DMI) that are created at IDMIL make use of isometric sensors like
    FSRs, or piezoelectric sensors on hard surfaces. The Membrain aims
    to provide a platform for instrument designers in the lab to explore
    the use of flexible membranes and how they can be incorporated into
    future DMIs. The paper will present the design of the prototype, the
    sensors used, the user interface, and the mappings used to test the
    prototype.}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-st-onge2025" class="csl-entry quarto-appendix-citeas" role="listitem">
<div class="">A.
St-Onge, <span>“Membrain: Extending the drumhead.”</span> [Online].
Available: <a href="https://segfaultdsp.com/posts/Membrain/">https://segfaultdsp.com/posts/Membrain/</a></div>
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>